# 订阅通知 | 我的代码没有else

> 嗯，我的代码没有`else`系列，一个设计模式业务真实使用的golang系列。

## 前言

本系列主要分享，如何在我们的真实业务场景中使用设计模式。

本系列文章主要采用如下结构：

- 什么是「XX设计模式」？
- 什么真实业务场景可以使用「XX设计模式」？
- 怎么用「XX设计模式」？

本文主要介绍「观察者模式」如何在真实业务场景中使用。

## 什么是「观察者模式」？

> 观察者观察被观察者，被观察者通知观察者

观察者模式的优势：

- 
- 

## 什么真实业务场景可以用「观察者模式」？

满足如下要求的所有场景:

> 

怎么理解，举个例子：

> 我们有哪些真实业务场景可以用「观察者模式」呢？

## 怎么用「观察者模式」？

关于怎么用，完全可以生搬硬套我总结的使用设计模式的四个步骤：

- 业务梳理
- 业务流程图
- 代码建模
- 代码demo

#### 业务梳理

未支付取消订单
已支付取消订单
取消发货单
拒收
退货
特殊退款

```
修改订单状态
记录订单状态变更日志
退优惠券
还优惠活动资格
还库存

还礼品卡
退钱包余额
生成退款单

修改发货单状态
记录发货单状态变更日志

发邮件
发短信
发微信消息

生成售后单
退运费

```

订单取消类型|涉及逻辑
-------|-------
取消未支付订单|-
-|修改订单状态
-|记录订单状态变更日志
-|退优惠券
-|还优惠活动资格
-|还库存
-|发邮件
-|发短信
-|发微信消息
超时关单|-
-|修改订单状态
-|记录订单状态变更日志
-|退优惠券
-|还优惠活动资格
-|还库存
-|发邮件
-|发短信
-|发微信消息
已支付取消订单(未生成发货单)|-
-|修改订单状态
-|记录订单状态变更日志
-|还优惠活动资格(看情况)
-|还库存
-|还礼品卡
-|退钱包余额
-|生成退款单
-|发邮件
-|发短信
-|发微信消息
取消发货单(未发货)|-
-|修改订单状态
-|记录订单状态变更日志
-|修改发货单状态
-|记录发货单状态变更日志
-|还优惠活动资格(看情况)
-|还库存
-|还礼品卡
-|退钱包余额
-|生成退款单
-|发邮件
-|发短信
-|发微信消息
拒收|-
-|修改订单状态
-|记录订单状态变更日志
-|修改发货单状态
-|记录发货单状态变更日志
-|还库存
-|还礼品卡
-|退钱包余额
-|生成退款单
-|发邮件
-|发短信
-|发微信消息
退货退款|-
-|修改订单状态
-|记录订单状态变更日志
-|修改发货单状态
-|记录发货单状态变更日志
-|还库存
-|还礼品卡
-|退钱包余额
-|生成退款单
-|发邮件
-|发短信
-|发微信消息
特殊退款|-
-|发邮件
-|发短信
-|发微信消息


> 注：流程不一定完全准确

结论：

#### 业务流程图

我们通过梳理的文本业务流程得到了如下的业务流程图：

![]()

#### 代码建模

同时得到了我们的UML图：

![]()

#### 代码demo

## 结语

最后总结下，「组合模式」抽象过程的核心是：

- 按模块划分：业务逻辑归类，收敛的过程。
- 父子关系(树)：把收敛之后的业务对象按父子关系绑定，依次被执行。

与「责任链模式」的区别：

- 责任链模式: 链表
- 组合模式：树

```
特别说明：
1. 我的代码没有`else`，只是一个在代码合理设计的情况下自然而然无限接近或者达到的结果，并不是一个硬性的目标，务必较真。
2. 本系列的一些设计模式的概念可能和原概念存在差异，因为会结合实际使用，取其精华，适当改变，灵活使用。
```

